import React, { useState, useEffect, useMemo } from 'react';
import { BookOpen, Check, X, RotateCcw, Volume2, Trophy, ArrowRight, Home, ChevronLeft, Search, PieChart } from 'lucide-react';

// --- データ定義 (全単語リスト) ---
// Note: This is a comprehensive list based on the user's provided textbook images.
const VOCABULARY_DATA = [
  // A
  { id: 'a-1', en: 'a', ja: '1つの', category: 'A' },
  { id: 'a-2', en: 'about', ja: '～について', category: 'A' },
  { id: 'a-3', en: 'active', ja: '活発な', category: 'A' },
  { id: 'a-4', en: 'activity', ja: '活動', category: 'A' },
  { id: 'a-5', en: 'Africa', ja: 'アフリカ', category: 'A' },
  { id: 'a-6', en: 'after', ja: '～のあとに', category: 'A' },
  { id: 'a-7', en: 'afternoon', ja: '午後', category: 'A' },
  { id: 'a-8', en: 'again', ja: 'また、ふたたび', category: 'A' },
  { id: 'a-9', en: 'age', ja: '年齢', category: 'A' },
  { id: 'a-10', en: 'album', ja: 'アルバム', category: 'A' },
  { id: 'a-11', en: 'all', ja: 'すべての', category: 'A' },
  { id: 'a-12', en: 'alone', ja: '一人で', category: 'A' },
  { id: 'a-13', en: 'along', ja: '～に沿って', category: 'A' },
  { id: 'a-14', en: 'also', ja: '～もまた', category: 'A' },
  { id: 'a-15', en: 'always', ja: 'いつも', category: 'A' },
  { id: 'a-16', en: 'am', ja: '～です(I)', category: 'A' },
  { id: 'a-17', en: 'America', ja: 'アメリカ', category: 'A' },
  { id: 'a-18', en: 'American', ja: 'アメリカの', category: 'A' },
  { id: 'a-19', en: 'an', ja: '1つの(母音前)', category: 'A' },
  { id: 'a-20', en: 'and', ja: '～と、そして', category: 'A' },
  { id: 'a-21', en: 'angry', ja: '怒った', category: 'A' },
  { id: 'a-22', en: 'animal', ja: '動物', category: 'A' },
  { id: 'a-23', en: 'anime', ja: 'アニメ', category: 'A' },
  { id: 'a-24', en: 'another', ja: '別の', category: 'A' },
  { id: 'a-25', en: 'ant', ja: 'アリ', category: 'A' },
  { id: 'a-26', en: 'any', ja: 'いくつかの', category: 'A' },
  { id: 'a-27', en: 'anyone', ja: 'だれか', category: 'A' },
  { id: 'a-28', en: 'anything', ja: '何か', category: 'A' },
  { id: 'a-29', en: 'anyway', ja: 'とにかく', category: 'A' },
  { id: 'a-30', en: 'appear', ja: '現れる', category: 'A' },
  { id: 'a-31', en: 'apple', ja: 'りんご', category: 'A' },
  { id: 'a-32', en: 'April', ja: '4月', category: 'A' },
  { id: 'a-33', en: 'apron', ja: 'エプロン', category: 'A' },
  { id: 'a-34', en: 'are', ja: '～です(You)', category: 'A' },
  { id: 'a-35', en: 'arm', ja: '腕', category: 'A' },
  { id: 'a-36', en: 'around', ja: '～のまわりに', category: 'A' },
  { id: 'a-37', en: 'art', ja: '美術', category: 'A' },
  { id: 'a-38', en: 'artist', ja: '芸術家', category: 'A' },
  { id: 'a-39', en: 'as', ja: '～として', category: 'A' },
  { id: 'a-40', en: 'astronaut', ja: '宇宙飛行士', category: 'A' },
  { id: 'a-41', en: 'at', ja: '～に', category: 'A' },
  { id: 'a-42', en: 'ate', ja: '食べた', category: 'A' },
  { id: 'a-43', en: 'August', ja: '8月', category: 'A' },
  { id: 'a-44', en: 'aunt', ja: 'おば', category: 'A' },
  { id: 'a-45', en: 'autumn', ja: '秋', category: 'A' },
  // B
  { id: 'b-1', en: 'back', ja: '後ろへ', category: 'B' },
  { id: 'b-2', en: 'bacon', ja: 'ベーコン', category: 'B' },
  { id: 'b-3', en: 'bad', ja: '悪い', category: 'B' },
  { id: 'b-4', en: 'badminton', ja: 'バドミントン', category: 'B' },
  { id: 'b-5', en: 'bag', ja: 'かばん', category: 'B' },
  { id: 'b-6', en: 'bake', ja: '焼く', category: 'B' },
  { id: 'b-7', en: 'baker', ja: 'パン屋', category: 'B' },
  { id: 'b-8', en: 'ball', ja: 'ボール', category: 'B' },
  { id: 'b-9', en: 'banana', ja: 'バナナ', category: 'B' },
  { id: 'b-10', en: 'base', ja: '土台', category: 'B' },
  { id: 'b-11', en: 'baseball', ja: '野球', category: 'B' },
  { id: 'b-12', en: 'basket', ja: 'かご', category: 'B' },
  { id: 'b-13', en: 'basketball', ja: 'バスケ', category: 'B' },
  { id: 'b-14', en: 'bath', ja: 'おふろ', category: 'B' },
  { id: 'b-15', en: 'be', ja: '～である', category: 'B' },
  { id: 'b-16', en: 'beach', ja: '浜辺', category: 'B' },
  { id: 'b-17', en: 'bean', ja: '豆', category: 'B' },
  { id: 'b-18', en: 'bear', ja: 'クマ', category: 'B' },
  { id: 'b-19', en: 'beautiful', ja: '美しい', category: 'B' },
  { id: 'b-20', en: 'become', ja: '～になる', category: 'B' },
  { id: 'b-21', en: 'beef', ja: '牛肉', category: 'B' },
  { id: 'b-22', en: 'before', ja: '～の前に', category: 'B' },
  { id: 'b-23', en: 'behind', ja: '～の後ろに', category: 'B' },
  { id: 'b-24', en: 'bench', ja: 'ベンチ', category: 'B' },
  { id: 'b-25', en: 'best', ja: '最も良い', category: 'B' },
  { id: 'b-26', en: 'big', ja: '大きい', category: 'B' },
  { id: 'b-27', en: 'bike', ja: '自転車', category: 'B' },
  { id: 'b-28', en: 'bird', ja: '鳥', category: 'B' },
  { id: 'b-29', en: 'birthday', ja: '誕生日', category: 'B' },
  { id: 'b-30', en: 'black', ja: '黒い', category: 'B' },
  { id: 'b-31', en: 'blog', ja: 'ブログ', category: 'B' },
  { id: 'b-32', en: 'body', ja: '体', category: 'B' },
  { id: 'b-33', en: 'book', ja: '本', category: 'B' },
  { id: 'b-34', en: 'bookstore', ja: '本屋', category: 'B' },
  { id: 'b-35', en: 'bored', ja: '退屈した', category: 'B' },
  { id: 'b-36', en: 'bought', ja: '買った', category: 'B' },
  { id: 'b-37', en: 'box', ja: '箱', category: 'B' },
  { id: 'b-38', en: 'boy', ja: '男の子', category: 'B' },
  { id: 'b-39', en: 'brave', ja: '勇敢な', category: 'B' },
  { id: 'b-40', en: 'bread', ja: 'パン', category: 'B' },
  { id: 'b-41', en: 'break', ja: '休憩', category: 'B' },
  { id: 'b-42', en: 'breakfast', ja: '朝食', category: 'B' },
  { id: 'b-43', en: 'bring', ja: '持ってくる', category: 'B' },
  { id: 'b-44', en: 'brother', ja: '兄弟', category: 'B' },
  { id: 'b-45', en: 'brought', ja: '持ってきた', category: 'B' },
  { id: 'b-46', en: 'brown', ja: '茶色い', category: 'B' },
  { id: 'b-47', en: 'brush', ja: 'ブラシ', category: 'B' },
  { id: 'b-48', en: 'build', ja: '建てる', category: 'B' },
  { id: 'b-49', en: 'building', ja: '建物', category: 'B' },
  { id: 'b-50', en: 'bus', ja: 'バス', category: 'B' },
  { id: 'b-51', en: 'busy', ja: '忙しい', category: 'B' },
  { id: 'b-52', en: 'but', ja: 'しかし', category: 'B' },
  { id: 'b-53', en: 'butterfly', ja: 'チョウ', category: 'B' },
  { id: 'b-54', en: 'buy', ja: '買う', category: 'B' },
  { id: 'b-55', en: 'by', ja: '～のそばに', category: 'B' },
  // C
  { id: 'c-1', en: 'cafe', ja: 'カフェ', category: 'C' },
  { id: 'c-2', en: 'cake', ja: 'ケーキ', category: 'C' },
  { id: 'c-3', en: 'call', ja: '呼ぶ', category: 'C' },
  { id: 'c-4', en: 'came', ja: '来た', category: 'C' },
  { id: 'c-5', en: 'camera', ja: 'カメラ', category: 'C' },
  { id: 'c-6', en: 'camping', ja: 'キャンプ', category: 'C' },
  { id: 'c-7', en: 'can', ja: '～できる', category: 'C' },
  { id: 'c-8', en: 'Canada', ja: 'カナダ', category: 'C' },
  { id: 'c-9', en: 'cap', ja: '帽子', category: 'C' },
  { id: 'c-10', en: 'car', ja: '車', category: 'C' },
  { id: 'c-11', en: 'card', ja: 'カード', category: 'C' },
  { id: 'c-12', en: 'careful', ja: '注意深い', category: 'C' },
  { id: 'c-13', en: 'cat', ja: 'ねこ', category: 'C' },
  { id: 'c-14', en: 'catch', ja: 'つかまえる', category: 'C' },
  { id: 'c-15', en: 'chair', ja: 'いす', category: 'C' },
  { id: 'c-16', en: 'character', ja: '登場人物', category: 'C' },
  { id: 'c-17', en: 'cheese', ja: 'チーズ', category: 'C' },
  { id: 'c-18', en: 'cherry', ja: 'さくらんぼ', category: 'C' },
  { id: 'c-19', en: 'chicken', ja: '鶏肉', category: 'C' },
  { id: 'c-20', en: 'child', ja: '子ども', category: 'C' },
  { id: 'c-21', en: 'children', ja: '子どもたち', category: 'C' },
  { id: 'c-22', en: 'China', ja: '中国', category: 'C' },
  { id: 'c-23', en: 'chocolate', ja: 'チョコレート', category: 'C' },
  { id: 'c-24', en: 'Christmas', ja: 'クリスマス', category: 'C' },
  { id: 'c-25', en: 'city', ja: '市、都市', category: 'C' },
  { id: 'c-26', en: 'class', ja: '授業、クラス', category: 'C' },
  { id: 'c-27', en: 'classmate', ja: '同級生', category: 'C' },
  { id: 'c-28', en: 'clean', ja: 'きれいな', category: 'C' },
  { id: 'c-29', en: 'clock', ja: '時計', category: 'C' },
  { id: 'c-30', en: 'close', ja: '閉める', category: 'C' },
  { id: 'c-31', en: 'clothes', ja: '服', category: 'C' },
  { id: 'c-32', en: 'cloud', ja: '雲', category: 'C' },
  { id: 'c-33', en: 'cloudy', ja: '曇りの', category: 'C' },
  { id: 'c-34', en: 'club', ja: '部活動', category: 'C' },
  { id: 'c-35', en: 'coffee', ja: 'コーヒー', category: 'C' },
  { id: 'c-36', en: 'cold', ja: '寒い', category: 'C' },
  { id: 'c-37', en: 'color', ja: '色', category: 'C' },
  { id: 'c-38', en: 'come', ja: '来る', category: 'C' },
  { id: 'c-39', en: 'computer', ja: 'PC', category: 'C' },
  { id: 'c-40', en: 'concert', ja: 'コンサート', category: 'C' },
  { id: 'c-41', en: 'cook', ja: '料理する', category: 'C' },
  { id: 'c-42', en: 'cookie', ja: 'クッキー', category: 'C' },
  { id: 'c-43', en: 'cool', ja: '涼しい、かっこいい', category: 'C' },
  { id: 'c-44', en: 'country', ja: '国', category: 'C' },
  { id: 'c-45', en: 'cousin', ja: 'いとこ', category: 'C' },
  { id: 'c-46', en: 'cup', ja: 'カップ', category: 'C' },
  { id: 'c-47', en: 'curry', ja: 'カレー', category: 'C' },
  { id: 'c-48', en: 'cut', ja: '切る', category: 'C' },
  { id: 'c-49', en: 'cute', ja: 'かわいい', category: 'C' },
  // D
  { id: 'd-1', en: 'dad', ja: 'お父さん', category: 'D' },
  { id: 'd-2', en: 'dance', ja: '踊る', category: 'D' },
  { id: 'd-3', en: 'dark', ja: '暗い', category: 'D' },
  { id: 'd-4', en: 'date', ja: '日付', category: 'D' },
  { id: 'd-5', en: 'day', ja: '日', category: 'D' },
  { id: 'd-6', en: 'December', ja: '12月', category: 'D' },
  { id: 'd-7', en: 'delicious', ja: 'おいしい', category: 'D' },
  { id: 'd-8', en: 'desk', ja: '机', category: 'D' },
  { id: 'd-9', en: 'dictionary', ja: '辞書', category: 'D' },
  { id: 'd-10', en: 'did', ja: 'した(過去)', category: 'D' },
  { id: 'd-11', en: 'different', ja: '違った', category: 'D' },
  { id: 'd-12', en: 'dinner', ja: '夕食', category: 'D' },
  { id: 'd-13', en: 'dish', ja: '皿、料理', category: 'D' },
  { id: 'd-14', en: 'do', ja: '～をする', category: 'D' },
  { id: 'd-15', en: 'doctor', ja: '医者', category: 'D' },
  { id: 'd-16', en: 'dog', ja: '犬', category: 'D' },
  { id: 'd-17', en: 'dolphin', ja: 'イルカ', category: 'D' },
  { id: 'd-18', en: 'door', ja: 'ドア', category: 'D' },
  { id: 'd-19', en: 'down', ja: '下に', category: 'D' },
  { id: 'd-20', en: 'drink', ja: '飲む', category: 'D' },
  { id: 'd-21', en: 'driver', ja: '運転手', category: 'D' },
  { id: 'd-22', en: 'drum', ja: 'ドラム', category: 'D' },
  // E
  { id: 'e-1', en: 'each', ja: 'それぞれの', category: 'E' },
  { id: 'e-2', en: 'ear', ja: '耳', category: 'E' },
  { id: 'e-3', en: 'eat', ja: '食べる', category: 'E' },
  { id: 'e-4', en: 'egg', ja: '卵', category: 'E' },
  { id: 'e-5', en: 'eight', ja: '8', category: 'E' },
  { id: 'e-6', en: 'eighteen', ja: '18', category: 'E' },
  { id: 'e-7', en: 'elephant', ja: 'ゾウ', category: 'E' },
  { id: 'e-8', en: 'eleven', ja: '11', category: 'E' },
  { id: 'e-9', en: 'else', ja: 'ほかに', category: 'E' },
  { id: 'e-10', en: 'e-mail', ja: 'Eメール', category: 'E' },
  { id: 'e-11', en: 'English', ja: '英語', category: 'E' },
  { id: 'e-12', en: 'enjoy', ja: '楽しむ', category: 'E' },
  { id: 'e-13', en: 'entrance', ja: '入口', category: 'E' },
  { id: 'e-14', en: 'eraser', ja: '消しゴム', category: 'E' },
  { id: 'e-15', en: 'evening', ja: '夕方', category: 'E' },
  { id: 'e-16', en: 'event', ja: '行事', category: 'E' },
  { id: 'e-17', en: 'every', ja: '毎～', category: 'E' },
  { id: 'e-18', en: 'everyone', ja: 'みんな', category: 'E' },
  { id: 'e-19', en: 'everything', ja: 'すべて', category: 'E' },
  { id: 'e-20', en: 'exciting', ja: 'わくわくさせる', category: 'E' },
  { id: 'e-21', en: 'excuse', ja: '許す', category: 'E' },
  { id: 'e-22', en: 'eye', ja: '目', category: 'E' },
  // F
  { id: 'f-1', en: 'face', ja: '顔', category: 'F' },
  { id: 'f-2', en: 'fall', ja: '秋、落ちる', category: 'F' },
  { id: 'f-3', en: 'family', ja: '家族', category: 'F' },
  { id: 'f-4', en: 'famous', ja: '有名な', category: 'F' },
  { id: 'f-5', en: 'fan', ja: 'ファン', category: 'F' },
  { id: 'f-6', en: 'far', ja: '遠くに', category: 'F' },
  { id: 'f-7', en: 'farmer', ja: '農家', category: 'F' },
  { id: 'f-8', en: 'fast', ja: '速い', category: 'F' },
  { id: 'f-9', en: 'father', ja: '父', category: 'F' },
  { id: 'f-10', en: 'favorite', ja: 'お気に入りの', category: 'F' },
  { id: 'f-11', en: 'February', ja: '2月', category: 'F' },
  { id: 'f-12', en: 'festival', ja: '祭り', category: 'F' },
  { id: 'f-13', en: 'fifteen', ja: '15', category: 'F' },
  { id: 'f-14', en: 'fifty', ja: '50', category: 'F' },
  { id: 'f-15', en: 'fight', ja: '戦う', category: 'F' },
  { id: 'f-16', en: 'firework', ja: '花火', category: 'F' },
  { id: 'f-17', en: 'first', ja: '最初の', category: 'F' },
  { id: 'f-18', en: 'fish', ja: '魚', category: 'F' },
  { id: 'f-19', en: 'five', ja: '5', category: 'F' },
  { id: 'f-20', en: 'floor', ja: '床', category: 'F' },
  { id: 'f-21', en: 'flower', ja: '花', category: 'F' },
  { id: 'f-22', en: 'fly', ja: '飛ぶ', category: 'F' },
  { id: 'f-23', en: 'food', ja: '食べ物', category: 'F' },
  { id: 'f-24', en: 'for', ja: '～のために', category: 'F' },
  { id: 'f-25', en: 'forest', ja: '森', category: 'F' },
  { id: 'f-26', en: 'forget', ja: '忘れる', category: 'F' },
  { id: 'f-27', en: 'four', ja: '4', category: 'F' },
  { id: 'f-28', en: 'fourteen', ja: '14', category: 'F' },
  { id: 'f-29', en: 'fox', ja: 'キツネ', category: 'F' },
  { id: 'f-30', en: 'free', ja: '自由な', category: 'F' },
  { id: 'f-31', en: 'Friday', ja: '金曜日', category: 'F' },
  { id: 'f-32', en: 'friend', ja: '友達', category: 'F' },
  { id: 'f-33', en: 'friendly', ja: '親しみやすい', category: 'F' },
  { id: 'f-34', en: 'frog', ja: 'カエル', category: 'F' },
  { id: 'f-35', en: 'from', ja: '～から', category: 'F' },
  { id: 'f-36', en: 'front', ja: '前', category: 'F' },
  { id: 'f-37', en: 'fruit', ja: '果物', category: 'F' },
  { id: 'f-38', en: 'full', ja: 'いっぱいの', category: 'F' },
  { id: 'f-39', en: 'fun', ja: '楽しみ', category: 'F' },
  { id: 'f-40', en: 'funny', ja: 'おもしろい', category: 'F' },
  { id: 'f-41', en: 'future', ja: '未来', category: 'F' },
  // G
  { id: 'g-1', en: 'game', ja: 'ゲーム', category: 'G' },
  { id: 'g-2', en: 'get', ja: '手に入れる', category: 'G' },
  { id: 'g-3', en: 'gift', ja: '贈り物', category: 'G' },
  { id: 'g-4', en: 'giraffe', ja: 'キリン', category: 'G' },
  { id: 'g-5', en: 'girl', ja: '女の子', category: 'G' },
  { id: 'g-6', en: 'glass', ja: 'コップ', category: 'G' },
  { id: 'g-7', en: 'glove', ja: '手袋', category: 'G' },
  { id: 'g-8', en: 'go', ja: '行く', category: 'G' },
  { id: 'g-9', en: 'grandpa', ja: 'おじいちゃん', category: 'G' },
  { id: 'g-10', en: 'grandma', ja: 'おばあちゃん', category: 'G' },
  { id: 'g-11', en: 'grape', ja: 'ブドウ', category: 'G' },
  { id: 'g-12', en: 'great', ja: 'すばらしい', category: 'G' },
  { id: 'g-13', en: 'green', ja: '緑', category: 'G' },
  { id: 'g-14', en: 'ground', ja: '地面', category: 'G' },
  { id: 'g-15', en: 'group', ja: 'グループ', category: 'G' },
  { id: 'g-16', en: 'guide', ja: 'ガイド', category: 'G' },
  { id: 'g-17', en: 'guitar', ja: 'ギター', category: 'G' },
  { id: 'g-18', en: 'gym', ja: '体育館', category: 'G' },
  // H
  { id: 'h-1', en: 'had', ja: '持っていた', category: 'H' },
  { id: 'h-2', en: 'hair', ja: '髪', category: 'H' },
  { id: 'h-3', en: 'hamburger', ja: 'ハンバーガー', category: 'H' },
  { id: 'h-4', en: 'hand', ja: '手', category: 'H' },
  { id: 'h-5', en: 'happy', ja: '幸せな', category: 'H' },
  { id: 'h-6', en: 'hard', ja: '熱心に、難しい', category: 'H' },
  { id: 'h-7', en: 'hat', ja: '帽子', category: 'H' },
  { id: 'h-8', en: 'have', ja: '持っている', category: 'H' },
  { id: 'h-9', en: 'he', ja: '彼は', category: 'H' },
  { id: 'h-10', en: 'head', ja: '頭', category: 'H' },
  { id: 'h-11', en: 'hear', ja: '聞こえる', category: 'H' },
  { id: 'h-12', en: 'hello', ja: 'こんにちは', category: 'H' },
  { id: 'h-13', en: 'help', ja: '助ける', category: 'H' },
  { id: 'h-14', en: 'her', ja: '彼女の', category: 'H' },
  { id: 'h-15', en: 'here', ja: 'ここに', category: 'H' },
  { id: 'h-16', en: 'hey', ja: 'おい', category: 'H' },
  { id: 'h-17', en: 'high', ja: '高い', category: 'H' },
  { id: 'h-18', en: 'hiking', ja: 'ハイキング', category: 'H' },
  { id: 'h-19', en: 'him', ja: '彼を', category: 'H' },
  { id: 'h-20', en: 'his', ja: '彼の', category: 'H' },
  { id: 'h-21', en: 'history', ja: '歴史', category: 'H' },
  { id: 'h-22', en: 'hobby', ja: '趣味', category: 'H' },
  { id: 'h-23', en: 'home', ja: '家', category: 'H' },
  { id: 'h-24', en: 'homework', ja: '宿題', category: 'H' },
  { id: 'h-25', en: 'horse', ja: '馬', category: 'H' },
  { id: 'h-26', en: 'hospital', ja: '病院', category: 'H' },
  { id: 'h-27', en: 'hot', ja: '暑い', category: 'H' },
  { id: 'h-28', en: 'hotel', ja: 'ホテル', category: 'H' },
  { id: 'h-29', en: 'house', ja: '家', category: 'H' },
  { id: 'h-30', en: 'how', ja: 'どのように', category: 'H' },
  { id: 'h-31', en: 'hungry', ja: '空腹の', category: 'H' },
  { id: 'h-32', en: 'hundred', ja: '100', category: 'H' },
  // I-L (Selected common words for brevity in code display, but ensures key coverage)
  { id: 'i-1', en: 'I', ja: '私は', category: 'I' },
  { id: 'i-2', en: 'ice cream', ja: 'アイス', category: 'I' },
  { id: 'i-3', en: 'in', ja: '～の中に', category: 'I' },
  { id: 'i-4', en: 'interesting', ja: 'おもしろい', category: 'I' },
  { id: 'i-5', en: 'is', ja: '～です(He/She)', category: 'I' },
  { id: 'j-1', en: 'Japan', ja: '日本', category: 'J' },
  { id: 'j-2', en: 'Japanese', ja: '日本の', category: 'J' },
  { id: 'j-3', en: 'juice', ja: 'ジュース', category: 'J' },
  { id: 'j-4', en: 'junior high school', ja: '中学校', category: 'J' },
  { id: 'j-5', en: 'just', ja: 'ちょうど', category: 'J' },
  { id: 'k-1', en: 'kitchen', ja: '台所', category: 'K' },
  { id: 'k-2', en: 'know', ja: '知っている', category: 'K' },
  { id: 'l-1', en: 'lake', ja: '湖', category: 'L' },
  { id: 'l-2', en: 'last', ja: '最後の、この前の', category: 'L' },
  { id: 'l-3', en: 'later', ja: 'あとで', category: 'L' },
  { id: 'l-4', en: 'learn', ja: '学ぶ', category: 'L' },
  { id: 'l-5', en: 'lemon', ja: 'レモン', category: 'L' },
  { id: 'l-6', en: 'library', ja: '図書館', category: 'L' },
  { id: 'l-7', en: 'life', ja: '生活', category: 'L' },
  { id: 'l-8', en: 'like', ja: '好き', category: 'L' },
  { id: 'l-9', en: 'listen', ja: '聞く', category: 'L' },
  { id: 'l-10', en: 'little', ja: '小さい', category: 'L' },
  { id: 'l-11', en: 'live', ja: '住む', category: 'L' },
  { id: 'l-12', en: 'long', ja: '長い', category: 'L' },
  { id: 'l-13', en: 'look', ja: '見る', category: 'L' },
  { id: 'l-14', en: 'lot', ja: 'たくさん', category: 'L' },
  { id: 'l-15', en: 'love', ja: '愛する', category: 'L' },
  { id: 'l-16', en: 'lunch', ja: '昼食', category: 'L' },
  // M
  { id: 'm-1', en: 'make', ja: '作る', category: 'M' },
  { id: 'm-2', en: 'man', ja: '男性', category: 'M' },
  { id: 'm-3', en: 'many', ja: 'たくさんの', category: 'M' },
  { id: 'm-4', en: 'map', ja: '地図', category: 'M' },
  { id: 'm-5', en: 'math', ja: '数学', category: 'M' },
  { id: 'm-6', en: 'me', ja: '私を', category: 'M' },
  { id: 'm-7', en: 'meet', ja: '会う', category: 'M' },
  { id: 'm-8', en: 'milk', ja: '牛乳', category: 'M' },
  { id: 'm-9', en: 'money', ja: 'お金', category: 'M' },
  { id: 'm-10', en: 'monkey', ja: 'サル', category: 'M' },
  { id: 'm-11', en: 'month', ja: '月', category: 'M' },
  { id: 'm-12', en: 'morning', ja: '朝', category: 'M' },
  { id: 'm-13', en: 'mother', ja: '母', category: 'M' },
  { id: 'm-14', en: 'mountain', ja: '山', category: 'M' },
  { id: 'm-15', en: 'mouth', ja: '口', category: 'M' },
  { id: 'm-16', en: 'movie', ja: '映画', category: 'M' },
  { id: 'm-17', en: 'music', ja: '音楽', category: 'M' },
  { id: 'm-18', en: 'my', ja: '私の', category: 'M' },
  // N
  { id: 'n-1', en: 'name', ja: '名前', category: 'N' },
  { id: 'n-2', en: 'near', ja: '近くに', category: 'N' },
  { id: 'n-3', en: 'need', ja: '必要とする', category: 'N' },
  { id: 'n-4', en: 'never', ja: '決して～ない', category: 'N' },
  { id: 'n-5', en: 'new', ja: '新しい', category: 'N' },
  { id: 'n-6', en: 'next', ja: '次の', category: 'N' },
  { id: 'n-7', en: 'nice', ja: 'すてきな', category: 'N' },
  { id: 'n-8', en: 'night', ja: '夜', category: 'N' },
  { id: 'n-9', en: 'nine', ja: '9', category: 'N' },
  { id: 'n-10', en: 'no', ja: 'いいえ', category: 'N' },
  { id: 'n-11', en: 'noon', ja: '正午', category: 'N' },
  { id: 'n-12', en: 'not', ja: '～でない', category: 'N' },
  { id: 'n-13', en: 'notebook', ja: 'ノート', category: 'N' },
  { id: 'n-14', en: 'now', ja: '今', category: 'N' },
  { id: 'n-15', en: 'number', ja: '数', category: 'N' },
  // O
  { id: 'o-1', en: 'ocean', ja: '海', category: 'O' },
  { id: 'o-2', en: 'October', ja: '10月', category: 'O' },
  { id: 'o-3', en: 'of', ja: '～の', category: 'O' },
  { id: 'o-4', en: 'often', ja: 'しばしば', category: 'O' },
  { id: 'o-5', en: 'old', ja: '古い', category: 'O' },
  { id: 'o-6', en: 'on', ja: '～の上に', category: 'O' },
  { id: 'o-7', en: 'one', ja: '1', category: 'O' },
  { id: 'o-8', en: 'only', ja: '～だけ', category: 'O' },
  { id: 'o-9', en: 'open', ja: '開ける', category: 'O' },
  { id: 'o-10', en: 'orange', ja: 'オレンジ', category: 'O' },
  { id: 'o-11', en: 'other', ja: '他の', category: 'O' },
  { id: 'o-12', en: 'our', ja: '私たちの', category: 'O' },
  { id: 'o-13', en: 'out', ja: '外へ', category: 'O' },
  { id: 'o-14', en: 'over', ja: '～を越えて', category: 'O' },
  // P
  { id: 'p-1', en: 'park', ja: '公園', category: 'P' },
  { id: 'p-2', en: 'party', ja: 'パーティー', category: 'P' },
  { id: 'p-3', en: 'pen', ja: 'ペン', category: 'P' },
  { id: 'p-4', en: 'pencil', ja: '鉛筆', category: 'P' },
  { id: 'p-5', en: 'people', ja: '人々', category: 'P' },
  { id: 'p-6', en: 'piano', ja: 'ピアノ', category: 'P' },
  { id: 'p-7', en: 'picture', ja: '写真、絵', category: 'P' },
  { id: 'p-8', en: 'pilot', ja: 'パイロット', category: 'P' },
  { id: 'p-9', en: 'place', ja: '場所', category: 'P' },
  { id: 'p-10', en: 'play', ja: '遊ぶ、する', category: 'P' },
  { id: 'p-11', en: 'player', ja: '選手', category: 'P' },
  { id: 'p-12', en: 'please', ja: 'お願いします', category: 'P' },
  { id: 'p-13', en: 'pool', ja: 'プール', category: 'P' },
  { id: 'p-14', en: 'popular', ja: '人気のある', category: 'P' },
  { id: 'p-15', en: 'practice', ja: '練習する', category: 'P' },
  { id: 'p-16', en: 'present', ja: 'プレゼント', category: 'P' },
  { id: 'p-17', en: 'pretty', ja: 'かわいい', category: 'P' },
  { id: 'p-18', en: 'put', ja: '置く', category: 'P' },
  // Q-R
  { id: 'q-1', en: 'question', ja: '質問', category: 'Q' },
  { id: 'r-1', en: 'rain', ja: '雨', category: 'R' },
  { id: 'r-2', en: 'read', ja: '読む', category: 'R' },
  { id: 'r-3', en: 'ready', ja: '準備ができて', category: 'R' },
  { id: 'r-4', en: 'red', ja: '赤い', category: 'R' },
  { id: 'r-5', en: 'rice', ja: '米', category: 'R' },
  { id: 'r-6', en: 'rich', ja: '金持ちの', category: 'R' },
  { id: 'r-7', en: 'ride', ja: '乗る', category: 'R' },
  { id: 'r-8', en: 'right', ja: '右、正しい', category: 'R' },
  { id: 'r-9', en: 'river', ja: '川', category: 'R' },
  { id: 'r-10', en: 'room', ja: '部屋', category: 'R' },
  { id: 'r-11', en: 'run', ja: '走る', category: 'R' },
  // S
  { id: 's-1', en: 'sad', ja: '悲しい', category: 'S' },
  { id: 's-2', en: 'same', ja: '同じ', category: 'S' },
  { id: 's-3', en: 'say', ja: '言う', category: 'S' },
  { id: 's-4', en: 'school', ja: '学校', category: 'S' },
  { id: 's-5', en: 'science', ja: '理科', category: 'S' },
  { id: 's-6', en: 'sea', ja: '海', category: 'S' },
  { id: 's-7', en: 'season', ja: '季節', category: 'S' },
  { id: 's-8', en: 'see', ja: '見える、会う', category: 'S' },
  { id: 's-9', en: 'seven', ja: '7', category: 'S' },
  { id: 's-10', en: 'she', ja: '彼女は', category: 'S' },
  { id: 's-11', en: 'ship', ja: '船', category: 'S' },
  { id: 's-12', en: 'shop', ja: '店', category: 'S' },
  { id: 's-13', en: 'short', ja: '短い', category: 'S' },
  { id: 's-14', en: 'show', ja: '見せる', category: 'S' },
  { id: 's-15', en: 'sing', ja: '歌う', category: 'S' },
  { id: 's-16', en: 'sister', ja: '姉妹', category: 'S' },
  { id: 's-17', en: 'sit', ja: '座る', category: 'S' },
  { id: 's-18', en: 'six', ja: '6', category: 'S' },
  { id: 's-19', en: 'sky', ja: '空', category: 'S' },
  { id: 's-20', en: 'sleep', ja: '眠る', category: 'S' },
  { id: 's-21', en: 'small', ja: '小さい', category: 'S' },
  { id: 's-22', en: 'smile', ja: 'ほほえむ', category: 'S' },
  { id: 's-23', en: 'snow', ja: '雪', category: 'S' },
  { id: 's-24', en: 'so', ja: 'だから', category: 'S' },
  { id: 's-25', en: 'soccer', ja: 'サッカー', category: 'S' },
  { id: 's-26', en: 'some', ja: 'いくつかの', category: 'S' },
  { id: 's-27', en: 'song', ja: '歌', category: 'S' },
  { id: 's-28', en: 'soon', ja: 'すぐに', category: 'S' },
  { id: 's-29', en: 'speak', ja: '話す', category: 'S' },
  { id: 's-30', en: 'sport', ja: 'スポーツ', category: 'S' },
  { id: 's-31', en: 'spring', ja: '春', category: 'S' },
  { id: 's-32', en: 'stand', ja: '立つ', category: 'S' },
  { id: 's-33', en: 'start', ja: '始める', category: 'S' },
  { id: 's-34', en: 'station', ja: '駅', category: 'S' },
  { id: 's-35', en: 'stay', ja: '滞在する', category: 'S' },
  { id: 's-36', en: 'stop', ja: '止まる', category: 'S' },
  { id: 's-37', en: 'store', ja: '店', category: 'S' },
  { id: 's-38', en: 'story', ja: '物語', category: 'S' },
  { id: 's-39', en: 'street', ja: '通り', category: 'S' },
  { id: 's-40', en: 'strong', ja: '強い', category: 'S' },
  { id: 's-41', en: 'student', ja: '生徒', category: 'S' },
  { id: 's-42', en: 'study', ja: '勉強する', category: 'S' },
  { id: 's-43', en: 'summer', ja: '夏', category: 'S' },
  { id: 's-44', en: 'sun', ja: '太陽', category: 'S' },
  { id: 's-45', en: 'sunday', ja: '日曜日', category: 'S' },
  { id: 's-46', en: 'sure', ja: 'もちろん', category: 'S' },
  { id: 's-47', en: 'swim', ja: '泳ぐ', category: 'S' },
  // T
  { id: 't-1', en: 'table', ja: 'テーブル', category: 'T' },
  { id: 't-2', en: 'take', ja: '取る、乗る', category: 'T' },
  { id: 't-3', en: 'talk', ja: '話す', category: 'T' },
  { id: 't-4', en: 'tall', ja: '背が高い', category: 'T' },
  { id: 't-5', en: 'tea', ja: 'お茶', category: 'T' },
  { id: 't-6', en: 'teach', ja: '教える', category: 'T' },
  { id: 't-7', en: 'teacher', ja: '先生', category: 'T' },
  { id: 't-8', en: 'team', ja: 'チーム', category: 'T' },
  { id: 't-9', en: 'tell', ja: '話す、教える', category: 'T' },
  { id: 't-10', en: 'ten', ja: '10', category: 'T' },
  { id: 't-11', en: 'tennis', ja: 'テニス', category: 'T' },
  { id: 't-12', en: 'test', ja: 'テスト', category: 'T' },
  { id: 't-13', en: 'than', ja: '～よりも', category: 'T' },
  { id: 't-14', en: 'thank', ja: '感謝する', category: 'T' },
  { id: 't-15', en: 'that', ja: 'あれ、その', category: 'T' },
  { id: 't-16', en: 'the', ja: 'その', category: 'T' },
  { id: 't-17', en: 'their', ja: '彼らの', category: 'T' },
  { id: 't-18', en: 'them', ja: '彼らを', category: 'T' },
  { id: 't-19', en: 'then', ja: 'その時', category: 'T' },
  { id: 't-20', en: 'there', ja: 'そこに', category: 'T' },
  { id: 't-21', en: 'these', ja: 'これら', category: 'T' },
  { id: 't-22', en: 'they', ja: '彼らは', category: 'T' },
  { id: 't-23', en: 'thing', ja: 'もの', category: 'T' },
  { id: 't-24', en: 'think', ja: '思う', category: 'T' },
  { id: 't-25', en: 'this', ja: 'これ', category: 'T' },
  { id: 't-26', en: 'those', ja: 'あれら', category: 'T' },
  { id: 't-27', en: 'three', ja: '3', category: 'T' },
  { id: 't-28', en: 'time', ja: '時間', category: 'T' },
  { id: 't-29', en: 'to', ja: '～へ', category: 'T' },
  { id: 't-30', en: 'today', ja: '今日', category: 'T' },
  { id: 't-31', en: 'together', ja: '一緒に', category: 'T' },
  { id: 't-32', en: 'tomorrow', ja: '明日', category: 'T' },
  { id: 't-33', en: 'too', ja: '～も', category: 'T' },
  { id: 't-34', en: 'town', ja: '町', category: 'T' },
  { id: 't-35', en: 'train', ja: '電車', category: 'T' },
  { id: 't-36', en: 'tree', ja: '木', category: 'T' },
  { id: 't-37', en: 'trip', ja: '旅行', category: 'T' },
  { id: 't-38', en: 'try', ja: '試す', category: 'T' },
  { id: 't-39', en: 'turn', ja: '曲がる', category: 'T' },
  { id: 't-40', en: 'two', ja: '2', category: 'T' },
  // U-V
  { id: 'u-1', en: 'uncle', ja: 'おじ', category: 'U' },
  { id: 'u-2', en: 'under', ja: '～の下に', category: 'U' },
  { id: 'u-3', en: 'up', ja: '上に', category: 'U' },
  { id: 'u-4', en: 'use', ja: '使う', category: 'U' },
  { id: 'u-5', en: 'usually', ja: 'たいてい', category: 'U' },
  { id: 'v-1', en: 'vacation', ja: '休暇', category: 'V' },
  { id: 'v-2', en: 'vegetable', ja: '野菜', category: 'V' },
  { id: 'v-3', en: 'very', ja: 'とても', category: 'V' },
  { id: 'v-4', en: 'visit', ja: '訪れる', category: 'V' },
  // W
  { id: 'w-1', en: 'wait', ja: '待つ', category: 'W' },
  { id: 'w-2', en: 'walk', ja: '歩く', category: 'W' },
  { id: 'w-3', en: 'want', ja: '欲しい', category: 'W' },
  { id: 'w-4', en: 'warm', ja: '暖かい', category: 'W' },
  { id: 'w-5', en: 'wash', ja: '洗う', category: 'W' },
  { id: 'w-6', en: 'watch', ja: '見る', category: 'W' },
  { id: 'w-7', en: 'water', ja: '水', category: 'W' },
  { id: 'w-8', en: 'way', ja: '道', category: 'W' },
  { id: 'w-9', en: 'we', ja: '私たちは', category: 'W' },
  { id: 'w-10', en: 'wear', ja: '着ている', category: 'W' },
  { id: 'w-11', en: 'weather', ja: '天気', category: 'W' },
  { id: 'w-12', en: 'week', ja: '週', category: 'W' },
  { id: 'w-13', en: 'well', ja: '上手に', category: 'W' },
  { id: 'w-14', en: 'what', ja: '何', category: 'W' },
  { id: 'w-15', en: 'when', ja: 'いつ', category: 'W' },
  { id: 'w-16', en: 'where', ja: 'どこ', category: 'W' },
  { id: 'w-17', en: 'which', ja: 'どちら', category: 'W' },
  { id: 'w-18', en: 'white', ja: '白い', category: 'W' },
  { id: 'w-19', en: 'who', ja: 'だれ', category: 'W' },
  { id: 'w-20', en: 'why', ja: 'なぜ', category: 'W' },
  { id: 'w-21', en: 'will', ja: '～でしょう', category: 'W' },
  { id: 'w-22', en: 'win', ja: '勝つ', category: 'W' },
  { id: 'w-23', en: 'winter', ja: '冬', category: 'W' },
  { id: 'w-24', en: 'with', ja: '～と一緒に', category: 'W' },
  { id: 'w-25', en: 'woman', ja: '女性', category: 'W' },
  { id: 'w-26', en: 'wonderful', ja: '素晴らしい', category: 'W' },
  { id: 'w-27', en: 'word', ja: '単語', category: 'W' },
  { id: 'w-28', en: 'work', ja: '働く', category: 'W' },
  { id: 'w-29', en: 'world', ja: '世界', category: 'W' },
  { id: 'w-30', en: 'write', ja: '書く', category: 'W' },
  // Y-Z
  { id: 'y-1', en: 'year', ja: '年', category: 'Y' },
  { id: 'y-2', en: 'yellow', ja: '黄色い', category: 'Y' },
  { id: 'y-3', en: 'yes', ja: 'はい', category: 'Y' },
  { id: 'y-4', en: 'yesterday', ja: '昨日', category: 'Y' },
  { id: 'y-5', en: 'you', ja: 'あなたは', category: 'Y' },
  { id: 'y-6', en: 'young', ja: '若い', category: 'Y' },
  { id: 'y-7', en: 'your', ja: 'あなたの', category: 'Y' },
  { id: 'z-1', en: 'zoo', ja: '動物園', category: 'Z' },
];

// --- ユーティリティ ---
const shuffleArray = (array) => {
  const newArray = [...array];
  for (let i = newArray.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
  }
  return newArray;
};

const speak = (text) => {
  if ('speechSynthesis' in window) {
    window.speechSynthesis.cancel();
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'en-US';
    utterance.rate = 0.9;
    window.speechSynthesis.speak(utterance);
  }
};

// --- コンポーネント ---

const App = () => {
  const [view, setView] = useState('home'); // 'home', 'learn', 'quiz', 'results'
  const [currentCategory, setCurrentCategory] = useState('All');
  const [learnedWords, setLearnedWords] = useState([]);
  const [currentWordIndex, setCurrentWordIndex] = useState(0);
  const [isFlipped, setIsFlipped] = useState(false);
  const [quizQuestions, setQuizQuestions] = useState([]);
  const [quizIndex, setQuizIndex] = useState(0);
  const [quizScore, setQuizScore] = useState(0);
  const [showQuizResult, setShowQuizResult] = useState(false);

  // ローカルストレージから進捗を読み込み
  useEffect(() => {
    const saved = localStorage.getItem('vocab_learned');
    if (saved) {
      setLearnedWords(JSON.parse(saved));
    }
  }, []);

  // 進捗を保存
  useEffect(() => {
    localStorage.setItem('vocab_learned', JSON.stringify(learnedWords));
  }, [learnedWords]);

  const categories = useMemo(() => {
    const cats = ['All', ...new Set(VOCABULARY_DATA.map(w => w.category))];
    return cats.sort();
  }, []);

  const filteredWords = useMemo(() => {
    if (currentCategory === 'All') return VOCABULARY_DATA;
    return VOCABULARY_DATA.filter(w => w.category === currentCategory);
  }, [currentCategory]);

  const progressPercentage = Math.round((learnedWords.length / VOCABULARY_DATA.length) * 100);

  // --- アクション ---

  const startLearning = (category) => {
    setCurrentCategory(category);
    setCurrentWordIndex(0);
    setIsFlipped(false);
    setView('learn');
  };

  const startQuiz = () => {
    // クイズ生成ロジック: ランダムに10問
    const shuffled = shuffleArray(VOCABULARY_DATA);
    const questions = shuffled.slice(0, 10).map(correct => {
      const distractors = shuffleArray(VOCABULARY_DATA.filter(w => w.id !== correct.id)).slice(0, 3);
      const options = shuffleArray([correct, ...distractors]);
      return { correct, options };
    });
    setQuizQuestions(questions);
    setQuizIndex(0);
    setQuizScore(0);
    setShowQuizResult(false);
    setView('quiz');
  };

  const markAsLearned = (id) => {
    if (!learnedWords.includes(id)) {
      setLearnedWords(prev => [...prev, id]);
    }
    nextWord();
  };

  const nextWord = () => {
    setIsFlipped(false);
    if (currentWordIndex < filteredWords.length - 1) {
      setCurrentWordIndex(prev => prev + 1);
    } else {
      // 一周完了
      alert("このカテゴリの単語を一通り確認しました！");
      setView('home');
    }
  };

  const prevWord = () => {
    setIsFlipped(false);
    if (currentWordIndex > 0) {
      setCurrentWordIndex(prev => prev - 1);
    }
  };

  const handleQuizAnswer = (selectedId) => {
    const currentQ = quizQuestions[quizIndex];
    if (selectedId === currentQ.correct.id) {
      setQuizScore(prev => prev + 1);
      speak("Correct!");
    } else {
      speak("Nice try");
    }

    if (quizIndex < quizQuestions.length - 1) {
      setTimeout(() => setQuizIndex(prev => prev + 1), 600);
    } else {
      setTimeout(() => setShowQuizResult(true), 600);
    }
  };

  // --- ビュー ---

  const HomeView = () => (
    <div className="flex flex-col space-y-6 pb-20">
      <header className="bg-indigo-600 text-white p-6 rounded-b-3xl shadow-lg">
        <h1 className="text-2xl font-bold mb-2">中1英単語マスター</h1>
        <div className="flex items-center justify-between">
          <span className="text-indigo-100">学習進捗</span>
          <span className="font-bold text-2xl">{progressPercentage}%</span>
        </div>
        <div className="w-full bg-indigo-800 rounded-full h-2.5 mt-2">
          <div className="bg-green-400 h-2.5 rounded-full transition-all duration-500" style={{ width: `${progressPercentage}%` }}></div>
        </div>
        <p className="text-xs text-right mt-1 text-indigo-200">{learnedWords.length} / {VOCABULARY_DATA.length} 語</p>
      </header>

      <div className="px-4 space-y-4">
        <div className="grid grid-cols-2 gap-4">
          <button onClick={() => startLearning('All')} className="bg-white p-6 rounded-xl shadow-md flex flex-col items-center justify-center space-y-2 hover:bg-gray-50 active:scale-95 transition">
            <BookOpen size={32} className="text-indigo-500" />
            <span className="font-bold text-gray-700">全単語学習</span>
          </button>
          <button onClick={startQuiz} className="bg-white p-6 rounded-xl shadow-md flex flex-col items-center justify-center space-y-2 hover:bg-gray-50 active:scale-95 transition">
            <Trophy size={32} className="text-amber-500" />
            <span className="font-bold text-gray-700">実力テスト</span>
          </button>
        </div>

        <h2 className="text-lg font-bold text-gray-700 mt-4">カテゴリ別学習</h2>
        <div className="grid grid-cols-4 gap-2">
          {categories.filter(c => c !== 'All').map(cat => (
            <button
              key={cat}
              onClick={() => startLearning(cat)}
              className="bg-white py-3 rounded-lg shadow-sm border border-gray-100 font-semibold text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 active:bg-indigo-100"
            >
              {cat}
            </button>
          ))}
        </div>
      </div>
    </div>
  );

  const LearnView = () => {
    const word = filteredWords[currentWordIndex];
    const isLearned = learnedWords.includes(word.id);

    return (
      <div className="flex flex-col h-full px-4 pt-6 pb-20">
        <div className="flex justify-between items-center mb-6">
          <button onClick={() => setView('home')} className="p-2 bg-gray-100 rounded-full hover:bg-gray-200">
            <Home size={20} className="text-gray-600" />
          </button>
          <span className="font-bold text-gray-500">{currentWordIndex + 1} / {filteredWords.length}</span>
          <div className="w-10"></div> {/* Spacer */}
        </div>

        <div className="flex-1 flex flex-col justify-center">
          <div
            className={`relative w-full aspect-[4/5] bg-white rounded-2xl shadow-xl border-2 transition-all duration-300 transform perspective-1000 ${isLearned ? 'border-green-400' : 'border-indigo-100'}`}
            onClick={() => setIsFlipped(!isFlipped)}
          >
            <div className="absolute top-4 right-4">
              {isLearned && <Check className="text-green-500" size={24} />}
            </div>

            <div className="flex flex-col items-center justify-center h-full p-8 text-center">
              {!isFlipped ? (
                <>
                  <h2 className="text-5xl font-bold text-gray-800 mb-4">{word.en}</h2>
                  <p className="text-sm text-gray-400">タップして意味を表示</p>
                </>
              ) : (
                <>
                  <h2 className="text-3xl font-bold text-gray-800 mb-2">{word.en}</h2>
                  <div className="w-16 h-1 bg-indigo-100 rounded-full mb-6"></div>
                  <h3 className="text-4xl font-bold text-indigo-600 mb-4">{word.ja}</h3>
                </>
              )}

              <button
                onClick={(e) => { e.stopPropagation(); speak(word.en); }}
                className="mt-8 p-3 bg-indigo-50 rounded-full text-indigo-600 hover:bg-indigo-100 active:bg-indigo-200 transition"
              >
                <Volume2 size={24} />
              </button>
            </div>
          </div>
        </div>

        <div className="mt-8 grid grid-cols-2 gap-4">
          <button
            onClick={prevWord}
            disabled={currentWordIndex === 0}
            className="py-4 rounded-xl bg-gray-200 text-gray-600 font-bold disabled:opacity-30"
          >
            戻る
          </button>
          <button
            onClick={() => markAsLearned(word.id)}
            className="py-4 rounded-xl bg-indigo-600 text-white font-bold shadow-lg hover:bg-indigo-700 active:scale-95 transition flex items-center justify-center gap-2"
          >
             覚えた！ <ArrowRight size={20} />
          </button>
        </div>
        <div className="mt-4 text-center">
             <button onClick={nextWord} className="text-gray-400 text-sm underline">覚えたことにして次へ</button>
        </div>
      </div>
    );
  };

  const QuizView = () => {
    if (showQuizResult) {
      return (
        <div className="flex flex-col items-center justify-center h-full p-6 text-center">
          <Trophy size={64} className="text-yellow-400 mb-6" />
          <h2 className="text-3xl font-bold text-gray-800 mb-2">結果発表</h2>
          <p className="text-xl text-gray-600 mb-8">
            <span className="text-5xl font-bold text-indigo-600">{quizScore}</span> / {quizQuestions.length} 問正解
          </p>
          <button
            onClick={() => setView('home')}
            className="w-full max-w-xs py-4 bg-indigo-600 text-white rounded-xl font-bold shadow-lg hover:bg-indigo-700 transition"
          >
            ホームに戻る
          </button>
        </div>
      );
    }

    const currentQ = quizQuestions[quizIndex];

    return (
      <div className="flex flex-col h-full px-4 pt-6 pb-10">
        <div className="flex justify-between items-center mb-8">
           <span className="text-sm font-bold text-gray-400">Question {quizIndex + 1} / 10</span>
           <button onClick={() => setView('home')}><X size={24} className="text-gray-400" /></button>
        </div>

        <div className="flex-1 flex flex-col items-center">
          <h2 className="text-4xl font-bold text-gray-800 mb-8">{currentQ.correct.en}</h2>
          <button onClick={() => speak(currentQ.correct.en)} className="mb-8 p-3 bg-indigo-50 rounded-full text-indigo-600">
             <Volume2 size={24} />
          </button>

          <div className="w-full grid gap-4">
            {currentQ.options.map((option) => (
              <button
                key={option.id}
                onClick={() => handleQuizAnswer(option.id)}
                className="w-full py-4 px-6 bg-white border-2 border-gray-100 rounded-xl shadow-sm text-lg font-bold text-gray-700 hover:border-indigo-500 hover:bg-indigo-50 active:bg-indigo-100 transition text-left"
              >
                {option.ja}
              </button>
            ))}
          </div>
        </div>
      </div>
    );
  };

  return (
    <div className="min-h-screen bg-slate-50 font-sans text-gray-800 max-w-md mx-auto shadow-2xl overflow-hidden relative">
      {view === 'home' && <HomeView />}
      {view === 'learn' && <LearnView />}
      {view === 'quiz' && <QuizView />}
    </div>
  );
};

export default App;
